# Описание технической части

## Кратко о проекте

Проект представляет собой сервис, предназначенный для определения таблиц на повёрнутых сканах документов и поворота сканов на правильный угол.

Проект состоит из:

- Модели машинного обучения (**YOLO v8 OBB**)
- Бэкенда (**FastAPI**)
- Фронтенда (**Angular**)

Для проекта настроены:

- Контейнеризация
- Автоматическое тестирование

Для проекта был создан:

- Дизайн страниц фронтенда

Модель предобучена на 57.5 тыс. изображений из датасета **pubtables-1m** и дообучена на собранном нами датасете (1548 изображений, 3714 с дополнениями).

Датасеты:

- [Собранный нами датасет](https://universe.roboflow.com/silly-cats/oriented-object-detection-sjxxy)
- [pubtables-1m](https://huggingface.co/datasets/bsmock/pubtables-1m)

---

## Модель

### **[./app-detector-ood](https://github.com/EliteHacker228/OrientedTablesDetector/tree/main/app-detector-ood)**

В проекте использовалась модель **YOLO v8 OBB**.

В силу ограничения вычислительных мощностей (обучение проводилось на платформе Kaggle с лимитом 30 часов в неделю и GoogleColab с лимитом ≈ 5 часов) было решено предобучить модель на 10% данных от датасета **pubtables-1m** (содержит скриншоты цифровых документов с таблицами без поворотов), а затем дообучить её на собранном и дополненном нами датасете.

Получившаяся модель способна определять:

- Внешние границы таблиц (повёрнутых и не повёрнутых) на изображениях
- Угол отклонения таблиц

---

## Бэкенд

### **[./app-fast-api-ood](https://github.com/EliteHacker228/OrientedTablesDetector/tree/main/app-fast-api-ood)**

Бэкенд написан на **FastAPI** и содержит контроллер `/upload`.  
Контроллер выполняет следующие функции:

1. Принимает файл, передаваемый пользователем
2. Считывает его как RGB-изображение
3. Использует обученную модель для:
   - Определения внешних границ таблицы (или таблиц)
   - Вычисления угла её поворота (средний угол для нескольких таблиц)
   - Восстановления ориентации изображения путём поворота на угол, умноженный на -1

Затем:

4. Создаётся изображение с аннотированными границами таблиц
5. Формируется восстановленное изображение
6. Оба изображения упаковываются в zip-архив, который возвращается пользователю в ответе

---

## Дизайн

### **[./FrontDesigner](https://github.com/EliteHacker228/OrientedTablesDetector/tree/main/FrontDesigner)**

Дизайн страниц фронтенда создан в сервисе **Pixso**. Макеты выгружены и сохранены в репозитории. Для дизайна был выбран минималистичный стиль.

---

## Фронтенд

### **[./front](https://github.com/EliteHacker228/OrientedTablesDetector/tree/main/front)**

Фронтенд написан на **Angular** и содержит следующие страницы:

- Загрузка
- Ожидание обработки
- Получение результата
- Ошибка (появляется, если обработка прервётся с ошибкой)

В проекте используется компонентный подход: главная страница содержит компоненты, которые динамически изменяются в зависимости от действий пользователя и результатов обработки.

---

## Контейнеризация

### **[./docker-compose.yml](https://github.com/EliteHacker228/OrientedTablesDetector/blob/main/docker-compose.yml)**

Для сервиса настроена контейнеризация:

- Для бэкенда и фронтенда написаны **Dockerfile**
- Каждый компонент запускается в отдельном контейнере

Для управления контейнерами создан **compose файл**, в котором настроены:

- Порты для контейнеров (80 — фронтенд, 8000 — бэкенд)
- Контекст
- Место для хранения файлов контейнера

---

## Тестирование

### **[./app-fast-api-ood/tests.py](https://github.com/EliteHacker228/OrientedTablesDetector/blob/main/app-fast-api-ood/tests.py)**

Для бэкенда написаны автоматические тесты, проверяющие:

- Корректность работы методов, предоставляющих доступ к функционалу обученной модели,
- Работу методов бэкенда

Типы тестов:

- Юнит-тесты
- Интеграционные тесты
- Регрессионные тесты
- Приёмочные тесты
- Параметризированные тесты
- Нагрузочные тесты (с использованием **Locust**)
